<link rel="stylesheet" href="screens/booking.css">  

<script>
	$(document).ready(function() {
 	  $("#Booking-Screen-Calendar").datepicker({
	    onSelect: function(dateText, instance) {
	      var newSelectedDate = new Date(dateText);
	      if (Backend.getReservationContext().date != null && newSelectedDate.getTime() == Backend.getReservationContext().date.getTime()) {
	        return;
	      }
	      Backend.getReservationContext().date = newSelectedDate;
	      
	      showTimes();
	      
        $("#Booking-Screen-Calendar").animate({ 
            marginLeft: "50px",
        }, 1000, function() {
          $("#Booking-Screen-TimeFrame").animate({ 
            opacity: 1,
  	      }, 1000);
        });
	    },
	    defaultDate: Backend.getCurrentDate(),
 	    minDate: Backend.getSchedulingBeginDate(),
	    maxDate: Backend.getSchedulingEndDate()
 	  });
 	  
 	  function showTimes() {
  	  $("#Booking-Screen-Duration").css("opacity", 0);
 	    $("#Booking-Screen-TimeFrame-Times").empty();
      $("#Booking-Screen-TimeFrame").animate({ 
        marginLeft: "150px",
      }, 1000);
 	   
 	    
 	    var intervals = Backend.getAvailableTimes(Backend.getReservationContext().date);
 	    for (var i in intervals) {
 	      var interval = intervals[i];
 	      
        var hours = interval.time.getHours();
	 	    var minutes = interval.time.getMinutes();
	 	    var ampm = hours >= 12 ? 'pm' : 'am';
	 	    hours = hours % 12;
	 	    hours = hours ? hours : 12;
	 	    
	 	    var duration = interval.maxDuration + (interval.maxDuration > 1 ? " hours" : " hour");
 	      
	 	    var timeInterval = $("<div class=\"booking-time-interval\">" + hours + ampm + " (" + duration + ")</div>").appendTo($("#Booking-Screen-TimeFrame-Times"));
 	      timeInterval.click(function(interval) {
 	       Backend.getReservationContext().interval = interval;
 	        
          showDurations();
 	        $("#Booking-Screen-TimeFrame").animate({ 
            marginLeft: "50px",
          }, 1000);
 	      }.bind(this, interval));
 	    }
 	  }
 	  
 	  function showDurations() {
 	    $("#Booking-Screen-Duration-Durations").empty();

      $("#Booking-Screen-Duration").animate({ 
        opacity: 1,
      }, 1000, function() {
   	    if (Backend.getReservationContext().interval.minDuration == Backend.getReservationContext().interval.maxDuration) {
   	     Backend.getReservationContext().duration = Backend.getReservationContext().interval.minDuration;
   	      showLocationMap();
   	    }
      });
 	    
 	    for (var i = Backend.getReservationContext().interval.minDuration; i <= Backend.getReservationContext().interval.maxDuration; i++) {
 	      var duration = $("<div class=\"booking-duration\">" + i + "</div>").appendTo($("#Booking-Screen-Duration-Durations"));
 	      duration.click(function(duration) {
 	       Backend.getReservationContext().duration = i;
 	        
 	        showLocationMap();
 	      }.bind(this, i));
 	    }
 	  }
 	  
 	  
 	  function showLocationMap() {
      $("#Booking-Screen-LocationMap").animate({ 
        marginTop: "50px",
        opacity: 1
      }, 1000);
 	  }
	});
</script>

<div id="Booking-Screen">
	<a href="main.html?screen=home">Home!</a>
	<div>
		<div id="Booking-Screen-Calendar"></div>
		<div id="Booking-Screen-TimeFrame">
			<div id="Booking-Screen-TimeFrame-Title">Take-off time</div>
			<div id="Booking-Screen-TimeFrame-Times"></div>
		</div>
		<div id="Booking-Screen-Duration">
			<div id="Booking-Screen-Duration-Title">Ride duration</div>
			<div id="Booking-Screen-Duration-Durations"></div>
		</div>
		<div id="Booking-Screen-LocationMap"></div>
	</div>
</div>
